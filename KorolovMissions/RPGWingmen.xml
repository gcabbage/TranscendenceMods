<?xml version="1.0" ?>

<TranscendenceModule>
<!-- Wingman encounter screen =========================================
	Screen for meeting wingmen. Just supports join/reject for now.

	Could add support for multiple encounters / leaving / rejoining etc.
-->

	<DockScreen UNID="&dsWingmanEncounter;"
		nestedScreen=	"true"
		inherit=		"&dsDockScreenBase;"
		>
		<OnScreenInit>
			(scrSetData gScreen 'wingman (@ gData 'wingman))
		</OnScreenInit>

		<InitialPane>
			(switch
				(not (typGetGlobalData (scrGetData gScreen 'wingman) 'status))
					"Intro"

				"AlreadyMeet"
				)
		</InitialPane>

		<Panes>
			<AlreadyMeet>
				<OnPaneInit>
					; Do nothing if already met
					(scrExitScreen gScreen)
				</OnPaneInit>
			</AlreadyMeet>

			<Intro>
				<OnPaneInit>
					(block (
						(wingman (scrGetData gScreen 'wingman))
						(acceptLabel (typTranslate wingman 'AcceptLabel))
						(declineLabel (typTranslate wingman 'DeclineLabel))
						)
						(scrSetDesc gScreen (typTranslate wingman 'Intro))
						(if acceptLabel
							(scrSetActionLabel theScreen 'actionAccept acceptLabel)
							)
						(if declineLabel
							(scrSetActionLabel theScreen 'actionDecline declineLabel)
							)
						)
				</OnPaneInit>
				<Actions>
					<Action id="actionAccept" default="1">
						(scrShowPane gScreen "ReplyAccept")
					</Action>

					<Action id="actionDecline" cancel="1">
						(scrShowPane gScreen "ReplyDecline")
					</Action>
				</Actions>
			</Intro>


			<ReplyAccept>
				<OnPaneInit>
					(scrSetDesc gScreen (typTranslate (scrGetData gScreen 'wingman) 'AcceptReply))
				</OnPaneInit>
				<Actions>
					<Action id="actionContinue" default="1" cancel="1">
						(block (ship)
							(setq ship (sysCreateShip (scrGetData gScreen 'wingman) gSource &svCommonwealth;))
							(objFireEvent ship "OrderJoinPlayer")
							(scrExitScreen gScreen)
							)
					</Action>
				</Actions>
			</ReplyAccept>

			<ReplyDecline>
				<OnPaneInit>
					(scrSetDesc gScreen (typTranslate (scrGetData gScreen 'wingman) 'DeclineReply))
				</OnPaneInit>
				<Actions>
					<Action id="actionContinue" default="1" cancel="1">
						(block Nil
							(typSetGlobalData (scrGetData gScreen 'wingman) "status" 'declined)
							(scrExitScreen gScreen)
							)
					</Action>
				</Actions>
			</ReplyDecline>

		</Panes>

		<Language>
			<Text id="actionAccept">"[A]ccept"</Text>
			<Text id="actionDecline">"[D]ecline"</Text>
			<Text id="actionDone">"[C]ontinue"</Text>
		</Language>

	</DockScreen>

</TranscendenceModule>
