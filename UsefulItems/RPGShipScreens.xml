<?xml version="1.0" encoding="utf-8"?>

<TranscendenceModule>

	<!-- Player ship's cargo hold -->

	<DockScreen UNID="&dsCargoHold;"
			name=				"Ship's Cargo Hold"
			desc=				"Interior of Ship"
			type=				"itemPicker"
			nestedScreen=		"true"
			>

		<ListOptions
			dataFrom=	"player"
			list=		"*U"
			/>

		<Panes>
			<Default
					desc=	"You are in your ship's cargo hold.">

				<OnPaneInit>
					(block (thisItem desc)
						(setq thisItem (scrGetItem gScreen))
						(switch
							(not thisItem)
								(setq gMaxCount 0)

							(itmIsInstalled thisItem)
								(setq gMaxCount 0)

							(setq gMaxCount (itmGetCount thisItem))
							)

						(if thisItem
							(block Nil
								(setq desc (cat "Unit mass: " (strMassString (itmGetMass thisItem))))
								(if (gr gMaxCount 1)
									(setq desc (cat desc " (" gMaxCount " at " (strMassString (multiply (itmGetMass thisItem) gMaxCount)) ")"))
									)
								(scrSetDesc gScreen desc)
								)
							)

						; Enable/disable actions
						(scrEnableAction gScreen 0 (gr gMaxCount 0))
						)
				</OnPaneInit>

				<Actions>
					<Action name="Jettison this Item" key="J" >
						(switch
							(gr gMaxCount 1)
								(scrShowPane gScreen "JettisonQuantity")

							(eq gMaxCount 1)
								(block (itemsToJettison)
									; Create cargo crate
									(if (not gDest)
										(setq gDest (sysCreateStation &stGenericCargoCrate; (sysVectorPolarOffset gPlayerShip 0 0)))
										)

									; Dump items
									(setq itemsToJettison (scrRemoveItem gScreen 1))
									(rpgJettisonItem gDest itemsToJettison)
									(scrShowPane gScreen "Default")
									)
							)
					</Action>

					<Action name="Use" key="U">
						(scrShowScreen gScreen &dsRPGUseItem; {
							useItem: (scrGetItem gScreen)
							})
					</Action>

					<Action name="Done" cancel="1" key="D">
						<Exit/>
					</Action>

				</Actions>

			</Default>

			<JettisonQuantity
					showCounter=	"true">

				<OnPaneInit>
					(block Nil
						(scrSetDesc gScreen (cat "How many items do you wish to jettison?"))
						(scrSetCounter gScreen gMaxCount)
						)
				</OnPaneInit>

				<Actions>
					<Action name="Jettison" default="1" key="J">
						(block (count)
							(setq count (scrGetCounter gScreen))
							(if (gr count gMaxCount)
								(scrSetCounter gScreen gMaxCount)
								(block (itemsToJettison)
									; Create cargo crate
									(if (not gDest)
										(setq gDest (sysCreateStation &stGenericCargoCrate; (sysVectorPolarOffset gPlayerShip 0 0)))
										)

									; Dump items
									(setq itemsToJettison (scrRemoveItem gScreen count))
									(rpgJettisonItem gDest itemsToJettison)
									(scrShowPane gScreen "Default")
									)
								)
							)
					</Action>

					<Action name="Cancel" cancel="1" key="C">
						<ShowPane pane="Default"/>
					</Action>

				</Actions>

			</JettisonQuantity>
		</Panes>

	</DockScreen>

</TranscendenceModule>
